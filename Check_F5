#!/usr/bin/env bash
set -euo pipefail

# Liste des partitions visibles pour l'utilisateur courant
tmsh -c "list auth partition one-line" \
| awk '{print $3}' \
| while IFS= read -r P; do
    [[ -z "$P" ]] && continue
    echo "===== /$P ====="
    # Liste les VS de la partition
    tmsh -c "cd /$P; list ltm virtual one-line" \
    | awk '/^ltm virtual \//{print $3}' \
    || true
    echo
  done
