#!/usr/bin/env bash
set -euo pipefail

#######################################
# CONFIG
#######################################
BASE_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SCRIPT_DIR="$BASE_DIR/scripts"
DEVICES_FILE="$BASE_DIR/devices.txt"

[[ -f "$DEVICES_FILE" ]] || { echo "‚ùå Fichier $DEVICES_FILE introuvable"; exit 1; }

# Export pour que les scripts le voient
export DEVICES_FILE

#######################################
# FUNCTIONS
#######################################
pause() {
  read -rp "Appuyez sur Entr√©e pour continuer..."
}

print_header() {
  clear
  echo "======================================"
  echo "   F5 BIG-IP Automation Console"
  echo "======================================"
  echo
}

run_script() {
  local script="$1"

  if [[ ! -x "$SCRIPT_DIR/$script" ]]; then
    echo "‚ùå Script introuvable ou non ex√©cutable : $script"
    pause
    return
  fi

  echo "‚ñ∂ Ex√©cution : $script"
  echo
  "$SCRIPT_DIR/$script"
  echo
  pause
}

#######################################
# MENU LOOP
#######################################
while true; do
  print_header
  echo "1) Rotation mots de passe"
  echo "2) Upload ISO / Hotfix"
  echo
  echo "0) Quitter"
  echo

  read -rp "Choix : " choice

  case "$choice" in
    1) run_script "change_psswd.sh" ;;
    2) run_script "f5-upload-iso.sh" ;;
    0) echo "üëã Au revoir"; exit 0 ;;
    *) echo "‚ùå Choix invalide"; pause ;;
  esac
done
